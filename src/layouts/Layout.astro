---
import { Button } from "@/components/ui/button";
import "../styles/global.css";
import { ModeToggle } from '@/components/ModeToggle';

const {
  title       = "sal de ahí",
  description = "Exige a tus representantes e instituciones públicas que abandonen redes sociales gobernadas por oligarcas.",
  image       = "/og-image.png",
} = Astro.props;

const siteBase  = Astro.site?.toString().replace(/\/$/, '') ?? 'https://saldeahi.es';
const ogImage   = image.startsWith('http') ? image : `${siteBase}${image}`;
const canonical = siteBase;
---

<!doctype html>
<html lang="es" class="h-full antialiased">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <link rel="icon" href="/favicon.png" sizes="any" />

    <title>{title}</title>
    <meta name="description" content={description} />

    <!-- OpenGraph -->
    <meta property="og:type"        content="website" />
    <meta property="og:url"         content={canonical} />
    <meta property="og:title"       content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image"        content={ogImage} />
    <meta property="og:image:width"  content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:locale"       content="es_ES" />
    <meta property="og:site_name"    content="sal de ahí" />

    <!-- Twitter / X -->
    <meta name="twitter:card"        content="summary_large_image" />
    <meta name="twitter:title"       content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image"       content={ogImage} />

    <!-- Fuentes -->
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300..700;1,300..700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.fontshare.com/css?f[]=satoshi@400,500,700&display=swap"
      rel="stylesheet"
    />

    <!-- Aplica tema antes del pintado para evitar FOUC -->
    <script is:inline>
      (() => {
        try {
          const saved = localStorage.getItem("theme");
          const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
          const theme = saved ?? (prefersDark ? "dark" : "light");
          if (theme === "dark") document.documentElement.classList.add("dark");
        } catch {}
      })();
    </script>
  </head>

  <body class="min-h-svh overflow-x-hidden grid grid-rows-[auto_1fr_auto] bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100">

    <header class="relative z-10">
      <div class="mx-auto max-w-screen-xl px-4 py-3">
        <div class="flex items-center justify-end">
          <Button variant="default">
            <a href="/porque">por qué</a>
          </Button>
        </div>
      </div>
    </header>

    <main class="relative">
      <section
        class="mx-auto max-w-screen-xl px-4 py-8"
        aria-labelledby="hero-title"
      >
        <div class="w-full text-center">
          <slot />
        </div>
      </section>
    </main>

    <footer>
      <div class="mx-auto max-w-2xl px-4 py-4 text-center text-md text-slate-900 dark:text-slate-400 mt-10">
        <span class="italic">Toda la información utilizada procede exclusivamente de fuentes públicas y se emplea con una finalidad estrictamente orientada a la participación ciudadana, sin ningún propósito comercial ni de explotación de datos.</span>
        <br /><br /> por <a target="_blank" class="underline font-bold" href="https://www.avelrom.es/about">avelrom</a>
      </div>
    </footer>

    <script is:inline>
      (() => {
        const btn = document.getElementById("theme-toggle");
        if (!btn) return;
        const applyAria = () => {
          const isDark = document.documentElement.classList.contains("dark");
          btn.setAttribute("aria-pressed", String(isDark));
          btn.setAttribute("aria-label", isDark ? "Cambiar a modo claro" : "Cambiar a modo oscuro");
        };
        const toggleTheme = () => {
          const nowDark = document.documentElement.classList.toggle("dark");
          try { localStorage.setItem("theme", nowDark ? "dark" : "light"); } catch {}
          applyAria();
        };
        applyAria();
        btn.addEventListener("click", toggleTheme);
      })();
    </script>
  </body>
</html>
